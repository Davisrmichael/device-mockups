<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mockup Maker iPhone • model-viewer</title>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    display: flex;
    height: 100vh;
  }
  #controls {
    padding: 20px;
    background: #f9f9f9;
    width: 250px;
    box-sizing: border-box;
  }
  #viewer {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
  }
  model-viewer {
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>

<div id="controls">
  <h2>Mockup Maker <span style="color: gray;">iPhone • model-viewer</span></h2>
  <label>Screen Texture<br>
    <input type="file" id="textureInput" accept="image/*">
  </label>
  <br><br>
  <label>Rotate X (°)<br>
    <input type="range" id="rotX" min="-180" max="180" value="0">
  </label>
  <br><br>
  <label>Rotate Y (°)<br>
    <input type="range" id="rotY" min="-180" max="180" value="0">
  </label>
  <br><br>
  <button id="frontOn">Front-on</button>
</div>

<div id="viewer">
  <model-viewer id="mv"
    src="iPhone-15-Pro-converted/iphone_15_pro_max.gltf"
    camera-controls
    disable-zoom
    environment-image="neutral"
    exposure="1"
    shadow-intensity="1"
    style="background-color: transparent;">
  </model-viewer>
</div>

<script>
const mv = document.getElementById('mv');
const rotX = document.getElementById('rotX');
const rotY = document.getElementById('rotY');
const textureInput = document.getElementById('textureInput');
const frontOnBtn = document.getElementById('frontOn');

// Initial rotation to show front, but make slider show 0
let baseY = 180;
mv.addEventListener('load', () => {
  mv.orientation = `0deg ${baseY}deg 0deg`;
});

rotX.addEventListener('input', () => {
  mv.orientation = `${rotX.value}deg ${parseInt(rotY.value) + baseY}deg 0deg`;
});

rotY.addEventListener('input', () => {
  mv.orientation = `${rotX.value}deg ${parseInt(rotY.value) + baseY}deg 0deg`;
});

frontOnBtn.addEventListener('click', () => {
  rotX.value = 0;
  rotY.value = 0;
  mv.orientation = `0deg ${baseY}deg 0deg`;
});

// Apply uploaded texture
textureInput.addEventListener('change', async (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const url = URL.createObjectURL(file);
  const scene = mv.model.scene;
  let applied = false;

  scene.traverse((node) => {
    if (node.isMesh && node.material.map) {
      if (node.material.map.name.includes('gltf_embedded_18') ||
          node.material.map.name.includes('screen') ||
          node.material.name.toLowerCase().includes('screen')) {
        new THREE.TextureLoader().load(url, (texture) => {
          texture.flipY = false;
          node.material.map = texture;
          node.material.needsUpdate = true;
        });
        applied = true;
      }
    }
  });

  if (!applied) {
    console.warn('Screen texture not found in model.');
  }
});
</script>

</body>
</html>
