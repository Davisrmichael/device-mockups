<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>iPhone Mockup Maker</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      gap: 20px;
      padding: 20px;
    }
    #controls {
      max-width: 300px;
    }
    label { display: block; margin-top: 10px; }
    model-viewer {
      width: 600px;
      height: 600px;
      background-color: transparent;
    }
    input[type="range"] { width: 100%; }
  </style>
</head>
<body>

  <div id="controls">
    <h2>Mockup Maker <span style="color:#666;">iPhone • model-viewer</span></h2>
    <label>Screen Texture
      <input type="file" id="textureUpload" accept="image/*"/>
    </label>
    <label>Rotate X (°)
      <input type="range" id="rotateX" min="-180" max="180" value="0">
    </label>
    <label>Rotate Y (°)
      <input type="range" id="rotateY" min="-180" max="180" value="0">
    </label>
    <button id="frontOn">Front-on</button>
  </div>

  <model-viewer id="viewer"
    src="iPhone-15-Pro-converted/apple_iphone_15_pro_max_black.glb"
    ar
    auto-rotate
    camera-controls
    rotation-per-second="0"
    style="--poster-color: transparent;"
    exposure="1"
    alt="iPhone mockup">
  </model-viewer>

<script>
  const viewer = document.getElementById('viewer');
  const textureInput = document.getElementById('textureUpload');
  const rotateX = document.getElementById('rotateX');
  const rotateY = document.getElementById('rotateY');
  const frontOnBtn = document.getElementById('frontOn');

  // Internally set 180° Y rotation, but slider shows 0
  let internalRotateY = 180;
  viewer.cameraOrbit = `0deg ${internalRotateY}deg auto`;

  rotateX.addEventListener('input', () => {
    viewer.cameraOrbit = `${rotateX.value}deg ${internalRotateY}deg auto`;
  });

  rotateY.addEventListener('input', () => {
    internalRotateY = parseInt(rotateY.value) + 180; // offset so 0 looks like 180
    viewer.cameraOrbit = `${rotateX.value}deg ${internalRotateY}deg auto`;
  });

  frontOnBtn.addEventListener('click', () => {
    rotateX.value = 0;
    rotateY.value = 0;
    internalRotateY = 180;
    viewer.cameraOrbit = `0deg ${internalRotateY}deg auto`;
  });

  textureInput.addEventListener('change', async (event) => {
    const file = event.target.files[0];
    if (file) {
      const textureURL = URL.createObjectURL(file);
      const material = (await viewer.model?.materials?.[0]) || viewer.model.materials[0];
      if (material) {
        material.pbrMetallicRoughness.baseColorTexture.texture.source.setURI(textureURL);
      }
    }
  });
</script>

</body>
</html>
